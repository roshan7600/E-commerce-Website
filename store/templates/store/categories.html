{% extends "store/base.html" %}
{% load static %}
{% block content %}

<div style="background-color: #f8f9fa; min-height: 100vh; padding-bottom: 50px;">
  
  <!-- Hero Section -->
  <div style="background: linear-gradient(135deg, #343a40 0%, #212529 100%); padding: 80px 0; color: white;">
    <div class="container">
      <h1 style="font-size: 3rem; font-weight: 800;">
        {% if current_category %}{{ current_category.name }}{% else %}Our Categories{% endif %}
      </h1>
      <p style="font-size: 1.25rem; opacity: 0.9;">
        {% if current_category %}Products in this category{% else %}Browse by category{% endif %}
      </p>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container" style="padding-top: 50px;">
    <div class="row">
      
      <!-- Sidebar: All Categories -->
      <div class="col-lg-3 mb-4">
        <div class="bg-white rounded-3 shadow-sm p-3">
          <h5 class="fw-bold border-bottom pb-2"><i class="bi bi-list-ul"></i> All Categories</h5>
          <ul class="list-unstyled mt-3">
            {% for cat in all_categories %}
              <li class="mb-2">
                <a href="{% url 'category_products' cat.id %}"
                   class="category-link {% if current_category and current_category.id == cat.id %}active-category{% endif %}">
                  <i class="bi {% if current_category and current_category.id == cat.id %}bi-folder-fill{% else %}bi-folder{% endif %}"></i>
                  {{ cat.name }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>

      <!-- Right Panel: Products or Categories -->
      <div class="col-lg-9">
        {% if current_category %}
          <!-- Product Grid -->
          <div class="row">
            {% if products %}
              {% for product in products %}
              <div class="col-md-6 col-lg-4 mb-4">
                <div class="card h-100 shadow-sm">
                  
                  {% if product.on_sale %}
                  <div class="badge bg-danger position-absolute" style="top: 10px; right: 10px;">Sale</div>
                  {% endif %}

                  <img src="{{ product.image.url }}" class="card-img-top" style="height: 200px; object-fit: cover;" alt="{{ product.name }}">

                  <div class="card-body text-center">
                    <h5 class="card-title fw-semibold">{{ product.name }}</h5>
                    <p class="mb-1 text-muted small">In: {{ product.category.name }}</p>
                    
                    {% if product.on_sale %}
                      <div>
                        <span class="text-muted text-decoration-line-through">‚Çπ{{ product.price }}</span><br>
                        <span class="text-danger fw-bold">‚Çπ{{ product.sale_price }}</span>
                      </div>
                    {% else %}
                      <div class="fw-bold">‚Çπ{{ product.price }}</div>
                    {% endif %}
                  </div>

                  <div class="card-footer bg-white d-grid gap-2">
                    <a href="{% url 'product' product.id %}" class="btn btn-sm btn-outline-dark">üëÅ View</a>

                    {% if user.is_authenticated %}
                      {% if product.id in cart_products %}
                        <button class="btn btn-sm btn-success" disabled>üõí In Cart</button>
                      {% else %}
                        <a href="{% url 'add_to_cart' product.id %}" class="btn btn-sm btn-primary">üõí Add to Cart</a>
                      {% endif %}

                      {% if product.id in wishlist_products %}
                        <button class="btn btn-sm btn-outline-danger" disabled>‚ù§Ô∏è In Wishlist</button>
                      {% else %}
                        <a href="{% url 'add_to_wishlist' product.id %}" class="btn btn-sm btn-outline-danger">‚ô° Add to Wishlist</a>
                      {% endif %}
                    {% else %}
                      <a href="{% url 'login' %}" class="btn btn-sm btn-outline-secondary">Login to Add</a>
                    {% endif %}

                    {% if "glass" in product.name|lower or "sunglass" in product.name|lower %}
                      <!-- <a href="{% static 'tryon/index.html' %}" class="btn btn-sm btn-outline-primary" target="_blank">üëì Try-On</a> -->
                    {% endif %}
                  </div>

                </div>
              </div>
              {% endfor %}
            {% else %}
              <!-- No products message -->
              <div class="col-12 text-center">
                <div class="p-5 bg-white rounded shadow-sm">
                  <i class="bi bi-exclamation-circle text-muted" style="font-size: 2.5rem;"></i>
                  <h4 class="mt-3">No Products Found</h4>
                  <p class="text-muted">We don't have products in this category yet.</p>
                </div>
              </div>
            {% endif %}
          </div>
        {% else %}
          <!-- Category Grid -->
          <div class="row">
            {% for category in all_categories %}
            <div class="col-md-6 col-lg-4 mb-4">
              <div class="card h-100 shadow-sm">
                <div class="bg-dark d-flex align-items-center justify-content-center" style="height: 140px;">
                  <i class="bi bi-tags text-white" style="font-size: 2rem;"></i>
                </div>
                <div class="card-body text-center">
                  <h5 class="fw-bold">{{ category.name }}</h5>
                  <a href="{% url 'category_products' category.id %}" class="btn btn-sm btn-dark mt-2">Browse Products</a>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<style>
.category-link {
  text-decoration: none;
  color: #212529;
  padding: 6px 12px;
  display: block;
  border-radius: 5px;
  transition: 0.2s ease;
}
.category-link:hover {
  background-color: #e9ecef;
}
.active-category {
  background-color: #dbeafe;
  color: #0d6efd !important;
  font-weight: bold;
}
</style>

{% endblock %}
